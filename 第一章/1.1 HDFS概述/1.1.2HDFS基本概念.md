## 数据块 (Block)
HDFS的文件是以文件块的方式存储的，Block是HDFS最小的存储单元，，由于HDFS的文件往往比较大，为了减少寻址的开销，所以HDFS文件块也比较大，默认为128M。 HDFS的文件块是以文件的方式存储在用户节点的磁盘上。

在HDFS中，所有的文件都会被切分为若干个数据块分布在数据节点上存储。 同时由于HDFS会将同一个数据块冗余备份到其他的节点上，（一个数据块默认是存3份），所以一个数据块的丢失并不影响这个数据块的访问。

在HDFS的读和写操作中，数据块都是最小的单元。 在读操作中，HDFS客户端首先到NameNode节点上查找HDFS文件包含的数据块位置信息，然后根据位置快的位置信息从数据节点上读取数据。在写操作过程中，HDFS客户端
也会首先从NameNode节点上申请新的数据块，然后根据申请的数据块位置信息建立数据流管道写数据。  

## NameNode  
HDFS是一个典型的Master/Slave结构的分布式系统，NameNode是HDFS主从结构的主节点。 NameNode管理着文件系统的命名空间namespace，包括文件系统目录树，文件目录信息以及文件数据块索引，这些文件以两个
文件的形式，保存在NameNode所在机器的本地磁盘上，即镜像文件和编辑日志文件。同时NameNode还保存着数据块与DataNode的对应关系，这部分的数据不保存在本地磁盘上，而是在NameNode启动的时候动态构建的。
HDFS客户端会通过NameNode节点来获取上述信息，之后读写数据。

NameNode是HDFS的单一节点，如果NameNode丢失元数据或者损坏，文件系统将出现错误，甚至无法使用。 为了解决这个问题，Hadoop2.x引入了对HA的支持。
在HA的实现结构中，同一个HDFS集群中会配置两个NameNode节点，活动节点和备用节点，活动节点的内存元数据与备用节点是完全同步的，那么活动节点发生故障而停止时，备用节点会立即切换为活动状态，而不影响
HDFS集群的服务。

NameNode的内存除了保存文件系统的命名空间外，还保存了文件系统中所有数据块与数据节点的对应关系，这意味着如果集群中文件数量过多，NameNode的内存会成为限制系统横向扩展的瓶颈。 为了解决这个问题，
Hadoop2.x引入了HDFS的Federation。 这个机制允许添加NameNode节点来实现namespace volume。 namespace volume是相互独立的，两两之间并不相互通信，甚至一个节点消失了也不影响其他节点维护命名空间
的可用性。 例如一个节点管理着/user目录下的所有文件，而另外一个节点维护着/share目录下的所有文件，这两个节点相互运行，互不影响。

## DataNode
DataNode会根据HDFS客户端请求或者NameNode调度将新的数据块写入到本地存储，或者读出本地存储的数据块。会不停的向NameNode节点发送心跳，数据块汇报以及缓存汇报，NameNode通过通过这些响应来向DataNode
发送命令，DataNode来实现这些命令。 例如创建、删除或者复制等等了。

## 客户端
HDFS提供了多种结构功能，包括命令行接口，浏览器接口，API接口。 这些是基于DFSClient类上实现的

## HDFS通信协议
HDFS作为一个文件系统，很多的流程是很复杂的，需要涉及到DataNode、NameNode和Client之间的相互配合调用才能实现，为了降低节点之间的耦合性，提升单个节点的内聚性，HDFS将这些节点抽象成不同的接口。

HDFS节点间主要接口有两种类型：
* Hadoop RPC接口： HDFS基于Hadoop RPC框架实现的接口。
* 流式接口：HDFS中基于TCP或者HTTP实现的接口。
